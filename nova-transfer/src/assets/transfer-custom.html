<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
  <title>Stencil Component Starter</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <script type="module" src="/build/nova-transfer.esm.js"></script>
  <script nomodule src="/build/nova-transfer.js"></script>
  <style>
    body { font-family: sans-serif; background-color: rgb(224, 60, 199);}
    p { margin: 0; padding: 0; }
    table { width: 100%; }
  </style>
</head>
<body>
  <nova-transfer 
    show-search
    show-select-all>
    <p slot="source-footer" style="text-align:center; padding: 10px 0;">footer 1</p>
    <p slot="target-footer" style="text-align:center; padding: 10px 0;">footer 2</p>
    <table slot="source-column" id="source-table">
    </table>
    <table slot="target-column" id="target-table">
    </table>
  </nova-transfer>
  <script>
    var transfer = document.querySelector("nova-transfer");

    transfer.addEventListener('transferColumn', event => { 
      var { targetKeys } = event.detail;
      fillSourceTable(data.items.filter(item => targetKeys.indexOf(item.key) === -1));
      fillTargetTable(data.items.filter(item => targetKeys.indexOf(item.key) !== -1));
    });

    transfer.addEventListener('select', event => {
      updateCheckboxes([...event.detail.sourceSelectedKeys, ...event.detail.targetSelectedKeys]);
    });

    transfer.addEventListener('filter', event => {
      var { direction, filteredKeys } = event.detail
      if (direction === 'left') {
        fillSourceTable(data.items.filter(item => filteredKeys.indexOf(item.key) !== -1));
      }
      else {
        fillTargetTable(data.items.filter(item => filteredKeys.indexOf(item.key) !== -1));
      }
    });

    transfer.filterOption = (value, item) => item.description.indexOf(value) !== -1
        || item.title.indexOf(value) !== -1;
        
    transfer.operationStyle = {
      padding: "7px",
      margin: 0,
      width: "10%;"
    }

    transfer.columnStyle = {
      width: "45%",
      boxShadow: "0px 0px 53px -11px rgba(0,0,0,1)"
    } 
 
    transfer.wrapperStyle = {
      width: "60%",
      height: "340px",
      minWidth: "500px",
      margin: "80px auto",
    }
  </script>

  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script>
    var data, configuration;
    // JSON load
    axios
    .get("transfer-data.json")
    .then(function(response) {
      data = response.data.data;
      transfer.data = data;
      configuration = response.data.configuration;
      transfer.configuration = configuration;
      fillSourceTable(data.items.filter(item => data.targetKeys.indexOf(item.key) === -1));
      fillTargetTable(data.items.filter(item => data.targetKeys.indexOf(item.key) !== -1));   
    })
    .catch(console.error); 
  </script>

  <script>
      fillSourceTable = (items) => {
        fillTable("#source-table", items);
      }

      fillTargetTable = (items) => {
        fillTable("#target-table", items);
      }
      
      fillTable = (id, items) => {
        var table = document.querySelector(id);
        if (items.length > 0 && table) {
          table.innerHTML = ''        
          var tableBody = document.createElement("tbody");
          var keys = Object.keys(items[0]);
          var noAttributes = keys.length;
          for (var i = 0; i < items.length; i++) {
            const item = items[i];
            var row = document.createElement("tr");
            row.setAttribute("id", item.key);
            row.classList.add("test");
            var checkbox = document.createElement("input");
            checkbox.setAttribute("type", "checkbox");
            checkbox.addEventListener('change', () => {
              transfer.handleSelect(item);
            });
            var cell = document.createElement("td");
            cell.appendChild(checkbox);
            row.append(cell);
            for (var j = 0; j < noAttributes; j++) {
              var cell = document.createElement("td");
              var cellText = document.createTextNode(items[i][keys[j]]);
              cell.appendChild(cellText);
              row.appendChild(cell);
            }
            tableBody.appendChild(row);
          }
          table.appendChild(tableBody);
        }
      }

      updateCheckboxes = (keys) => {
        console.log(keys)
        var table = document.querySelector("#source-table");
        if (table) {
          table.querySelectorAll("tr")
          .forEach(tr => {
            var checkbox = tr.querySelector("input[type='checkbox']");
            if (keys.indexOf(tr.getAttribute("id")) !== -1) {
              checkbox.checked = true;
            }
            else {
              checkbox.checked = false;
            }
          });
        }
        table = document.querySelector("#target-table");
        if (table) {
          table.querySelectorAll("tr")
          .forEach(tr => {
            var checkbox = tr.querySelector("input[type='checkbox']");
            console.log(checkbox);
            console.log(tr.getAttribute("id"));
            if (keys.indexOf(tr.getAttribute("id")) !== -1) {
              checkbox.checked = true;
            }
            else {
              checkbox.checked = false;
            }
          });
        }
      }
  </script>
    
</body>
</html>
