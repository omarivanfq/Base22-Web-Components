<!DOCTYPE html>
<html dir="ltr" lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=5.0">
  <title>Stencil Component Starter</title>
  <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.0.13/css/all.css" integrity="sha384-DNOHZ68U8hZfKXOrtjWvjxusGo9WQnrNx2sqG0tfsghAvtVlRW3tvkXWZh58N9jp" crossorigin="anonymous">
  <script type="module" src="/build/nova-transfer.esm.js"></script>
  <script nomodule src="/build/nova-transfer.js"></script>
  <script src="https://unpkg.com/@bentoboxes/nova-web-components@latest/dist/nova-web-components.js"></script>
  <style>
    body {
      font-family: sans-serif;
    }
    p {
      margin: 0;
      padding: 0;
    }
    ul {
      list-style: none;
      width: 100%;
      text-align: center;
      margin: 0;
      padding: 0;
    }
    ul li {
      margin: 7px 0;
      padding: 4px 0;
      color: white;
      background-color: #acd639;
      user-select: none;
    }
  </style>
</head>
<body>
  <div>
    <nova-transfer show-select-all show-search>
      <div slot="source-column">
        <table id="source-table">
        </table>
      </div>
      <div slot="target-column">
        <table id="target-table">
        </table>
      </div>
      <span slot="source-footer">
          <p style="text-align:center; padding: 10px 0;">footer 1</p>
        </span>
        <span slot="target-footer">
          <p style="text-align:center; padding: 10px 0;">footer 2</p>
        </span>
    </nova-transfer>
    <ul>
    </ul>
  </div>

  <script>
        var data = 
    {"items": [
      {
        "key": "key1",
        "title": "Title1",
        "description": "Description1",
        "disabled": false
      },
      {
        "key": "key2",
        "title": "Title2",
        "description": "Description2",
        "disabled": false
      },
      {
        "key": "key3",
        "title": "Title3",
        "description": "Description3",
        "disabled": false
      },
      {
        "key": "key4",
        "title": "Title4",
        "description": "Description4",
        "disabled": false
      },
      {
        "key": "key5",
        "title": "Title5",
        "description": "Description5",
        "disabled": false
      },
      {
        "key": "key6",
        "title": "Title6",
        "description": "Description6",
        "disabled": false
      },
      {
        "key": "key7",
        "title": "Title7",
        "description": "Description7",
        "disabled": false
      },
      {
        "key": "key9",
        "title": "Title9",
        "description": "Description9",
        "disabled": false
      },
      {
        "key": "key10",
        "title": "Title10",
        "description": "Description10",
        "disabled": false
      },
      {
        "key": "key11",
        "title": "Title11",
        "description": "Description11",
        "disabled": false
      }
    ],
    "targetKeys": [
        "key6", "key11"
      ]
    };
    var configuration = { labels: { titleSource: "Source", titleTarget: "Target", notFoundContent: "No Data" } };
  </script>

  <script>
    var transfer = document.querySelector("nova-transfer");
   // transfer.addEventListener('scrolling', e => console.log(e.detail));
   // transfer.addEventListener('search', event => console.log(event.detail));

    transfer.addEventListener('filter', event => {
      var { direction, filteredKeys } = event.detail
      if (direction === 'left') {
        fillSourceTable(data.items.filter(item => filteredKeys.indexOf(item.key) !== -1));
      }
      else {
        fillTargetTable(data.items.filter(item => filteredKeys.indexOf(item.key) !== -1));
      }
    });

    transfer.addEventListener('select', event => {
      updateCheckboxes(event.detail.sourceSelectedKeys);
    });

    transfer.addEventListener('transferColumn', event => { 
      var { targetKeys } = event.detail;
      fillSourceTable(data.items.filter(item => targetKeys.indexOf(item.key) === -1));
      fillTargetTable(data.items.filter(item => targetKeys.indexOf(item.key) !== -1));
    });

   /*
   transfer.filterOption = (value, option) => true;

   transfer.renderItem = item => {
      return item.title + ', ' + item.description;
    }

   transfer.operationStyle = {
      width:"2%"
    }

    transfer.operationStyle = {
      backgroundColor: "rgba(0,0,0,0.05)",
      padding: "7px",
      margin: 0
    }
    */

    transfer.columnStyle = {
      width: "49%",
    } 
 
    transfer.wrapperStyle = {
      width: "60%",
      margin: "0 auto",
      height: "350px",
    }

    transfer.data = data;
    transfer.configuration = configuration;

  </script>

<script>
    fillSourceTable = (items) => {
      fillTable("#source-table", items);
    }

    fillTargetTable = (items) => {
      fillTable("#target-table", items);
    }
    
    fillTable = (id, items) => {
      var table = document.querySelector(id);
      if (items.length > 0 && table) {
        table.innerHTML = ''
        var tableBody = document.createElement("tbody");
        var keys = Object.keys(items[0]);
        var noAttributes = keys.length;
        for (var i = 0; i < items.length; i++) {
          const item = items[i];
          var row = document.createElement("tr");
          row.setAttribute("id", item.key);
          row.classList.add("test");
          var checkbox = document.createElement("input");
          checkbox.setAttribute("type", "checkbox");
          checkbox.addEventListener('change', () => {
            transfer.handleSelect(item);
          });
          var cell = document.createElement("td");
          cell.appendChild(checkbox);
          row.append(cell);
          for (var j = 0; j < noAttributes; j++) {
            var cell = document.createElement("td");
            var cellText = document.createTextNode(items[i][keys[j]]);
            cell.appendChild(cellText);
            row.appendChild(cell);
          }
          tableBody.appendChild(row);
        }
        table.appendChild(tableBody);
      }
    }

    updateCheckboxes = (keys) => {
      console.log(keys);
      var table = document.querySelector("#source-table");
      if (table) {
        table.querySelectorAll("tr")
        .forEach(tr => {
          var checkbox = tr.querySelector("input[type='checkbox']");
          if (keys.indexOf(tr.getAttribute("id")) !== -1) {
            checkbox.checked = true;
          }
          else {
            checkbox.checked = false;
          }
        });
      }
    }
 
  </script>

  <script>
    fillSourceTable(data.items.filter(item => data.targetKeys.indexOf(item.key) === -1));
    fillTargetTable(data.items.filter(item => data.targetKeys.indexOf(item.key) !== -1));      
  </script>

</body>
</html>
